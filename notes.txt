Recibo la cantidad de personas pedidas, llamese p

Tomo con una chance del 40% algunas personas, supongamos, m personas
Cuento la cantidad de personas totales del archivo, supongamos n personas

Ahora si m < p,
genero p-m numeros aleatorios, que no esten en r,
siendo r el conjunto de personas seleccionadas anteriormente

una vez generado el conjunto nuevo de numeros,
recorro una vez mas el archivo para conseguir las personas faltantes

a la vez que voy cargando las personas, busco la ciudad de codigo mas alto
y lo guardo en max_city, estas serán el total de ciudades que necesitaré entrar

leo las max_city ciudades

escribo los archivos de salida

#######
Este approach sirve para ~10^7 ciudades y ~10^7 personas